<nz-layout fxFill>
  <div class="border-bottom-grey" fxLayoutAlign="start center">
    <img nz-image class="no_pointer_events buw-tmdt-logo" nzSrc="assets/tmdt.png" alt="The Logo of the Institute of TMDT"/>
  </div>

  <div fxLayout="row" fxLayoutAlign="center center" class="all">
    <!-- The left side of the demonstrator. -->
    <div fxLayout="column" fxLayoutAlign="space-between center" class="selfmade-menu">
      <div fxLayout="column" fxLayoutAlign=" center">
        <img nz-image class="no_pointer_events asag-logo" nzSrc="assets/asag_logo.png" alt="The project logo."/>
        <nz-divider></nz-divider>
        <h2 class="slideTitles"> {{ slideTitles[slideNumber] }}</h2>
        <p class="slideTexts"> {{ slideTexts[slideNumber] }}</p>
        <nz-divider></nz-divider>
        <div *ngIf="[1, 2].includes(slideNumber)" style="width: 100%" fxLayout="column" fxLayoutGap="20px">
          <h2> Schadensart: </h2>
          <nz-radio-group fxLayoutAlign="space-evenly" [(ngModel)]="chosenDamageType" (ngModelChange)="changeDamageType()">
            <label nz-radio-button nzValue="random">Zufällig</label>
            <label nz-radio-button nzValue="steps">Ecktritte</label>
            <label nz-radio-button nzValue="rungen">Rungen</label>
            <label nz-radio-button nzValue="holes">Löcher</label>
          </nz-radio-group>

          <div *ngIf="[1, 2].includes(slideNumber)" fxLayout="row" fxLayoutAlign="space-around center">
            <button nz-button [disabled]="bbButtonPressed" nzType="primary" nzSize="large" class="backwardButton" (click)="detect()">Erkennung</button>
            <button nz-button [disabled]="!bbButtonPressed || maskButtonPressed" nzType="primary" nzSize="large" class="forwardButton" (click)="segement()">Segmentierung</button>
          </div>
        </div>
      </div>
      <div style="width: 100%" fxLayout="row" fxLayoutAlign="space-around center">
        <button [disabled]="slideNumber == 0" nz-button nzSize="large" class="backwardButton" (click)="prev()">Previous</button>
        <button [disabled]="slideNumber == 1" nz-button nzSize="large" class="forwardButton" (click)="next()">Next</button>
      </div>
    </div>

    <!-- The right side of the demonstrator. -->
    <div class="image-area" id="image-area">
      <div style="height: 100%" *ngIf="slideNumber==0 && !loading" fxLayout="column" fxLayoutAlign="space-evenly">
        <div fxLayout="row" fxLayoutAlign="space-around">
          <video #videoPlayer1 (loadedmetadata)="calculateVideoHeight()" [loop]="true" [autoplay]="true" [muted]="true" preload="auto" [width]="videoWidth" [height]="videoHeight">
            <source src="assets/videos/Media1.mp4">
          </video>
        </div>
      </div>

      <div style="height: 100%; width: 100%" *ngIf="(slideNumber == 1 || slideNumber == 2) && !loading">
        <div style="height: 100%" fxLayout="column" fxLayoutAlign="space-evenly center">
          <map *ngFor="let coord of coords, let idx=index" name="aoi_{{idx}}">
            <area *ngFor="let c of coord, let i=index"
                  shape="rect" alt="Area of Interest"
                  nz-popover
                  nzPopoverTrigger="hover"
                  [nzPopoverContent]="damagedPartTpl"
                  nzPopoverPlacement="bottom"
                  (nzPopoverVisibleChange)="change(idx, i)"
                  coords="{{c.x1}} {{c.y1}} {{c.x2}} {{c.y2}}"
                  (mouseenter)="mouseEnteredArea(idx, i)"
                  (mouseleave)="mouseLeftArea()"
                  (click)="openDamagedPartModal(idx, i)">
          </map>

          <div class="all_images" *ngFor="let _ of shownImages, let i=index" fxLayout="column" fxLayoutAlign="space-evenly center">
            <img class="aoi_image layered_image first_image" [ngClass]="{'hidden_image': bbButtonPressed}" [src]="shownImages[i][0]" alt="Girl in a jacket" [height]="imageHeight" [width]="imageWidth">
            <img class="aoi_image layered_image second_image" useMap="#aoi_{{i}}" [ngClass]="{'hidden_image': maskButtonPressed}" [src]="segImages[i]" alt="Girl in a jacket" [height]="imageHeight" [width]="imageWidth">
            <img class="aoi_image layered_image third_image" [src]="maskImages[i]" alt="Girl in a jacket" [height]="imageHeight" [width]="imageWidth">
          </div>
        </div>
      </div>

      <div style="height: 100%" *ngIf="loading" fxLayout="column" fxLayoutAlign="center center">
        <nz-spin [nzSpinning]="loading" nzSize="large"></nz-spin>
      </div>
    </div>
  </div>
</nz-layout>

<nz-modal [(nzVisible)]="damagedPartModalVisible" nzTitle="The damaged part:" (nzOnCancel)="damagedPartModalVisible = false" [nzFooter]="null">
  <ng-container *nzModalContent>
    <div fxLayoutAlign="center center">
      <img nz-image class="no_pointer_events" [nzSrc]="enhancedDamagedPartSrc" alt="A damaged train part. Due." height="400">
    </div>
  </ng-container>
</nz-modal>

<nz-modal [(nzVisible)]="showHeightWidthWarning" nzTitle="Warning!" (nzOnCancel)="showHeightWidthWarning = false" [nzFooter]="null">
  <ng-container *nzModalContent>
    <div fxLayoutAlign="center center">
      <p>This website was not designed to be viewed on small screens like a mobile phone! Please keep in mind, that on a small screen this website might look like shit.</p>
    </div>
  </ng-container>
</nz-modal>

<ng-template #damagedPartTpl>
  <img [src]="enhancedDamagedPartSrc" alt="A damaged train part. Due." height="400">
</ng-template>

<app-footer></app-footer>
